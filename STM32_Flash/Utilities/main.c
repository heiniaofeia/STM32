/**
  ******************************************************************************
  * @file    main.c
  * @author  fire
  * @version V1.0
  * @date    2013-xx-xx
  * @brief   USART printf example
  ******************************************************************************
  * @attention
  *
  * 实验平台:野火 iSO-MINI STM32 开发板 
  * 论坛    :http://www.chuxue123.com
  * 淘宝    :http://firestm32.taobao.com
  *
  ******************************************************************************
  */
  
#include "stm32f10x.h"
#include "bsp_SysTick.h"
#include "stdio.h"
#include "bsp_led.h"  
#include "bsp_usart1.h"
#include "Matrixkey.h"
#include "1602.h" 
#include "bsp_TiMbase.h" 
#include "24cxx.h" 
#include "stmflash.h"


/*-------------------------------------------------------------------------------------------------------------------------------------------*/

/*1602-------------------------------------------------------------------------------------------------------------------------------------------*/
uint8_t Array_Word[] = "Lcd1602!";
uint16_t Counter;
/*-------------------------------------------------------------------------------------------------------------------------------------------*/

/*Matrixkey-------------------------------------------------------------------------------------------------------------------------------------------*/
uint8_t KeyTemp;
/*-------------------------------------------------------------------------------------------------------------------------------------------*/

/*Time7-------------------------------------------------------------------------------------------------------------------------------------------*/
volatile u32 time = 0; 							/* ms 计时变量 */
/*-------------------------------------------------------------------------------------------------------------------------------------------*/

/*Flash-------------------------------------------------------------------------------------------------------------------------------------------*/
const u8 FlashWriteBuffer[]={"STM32 FLASH TEST"};	/*要写入到STM32 FLASH的字符串数组*/
#define FlashSIZE sizeof(FlashWriteBuffer)	 			/*数组长度*/
#define FLASH_SAVE_ADDR  0X08070000 			/*设置FLASH 保存地址(必须为偶数)*/
u8 FlashReadBuffer[FlashSIZE];
/*-------------------------------------------------------------------------------------------------------------------------------------------*/
 
 /**
  * @brief  主函数
  * @param  无
  * @retval 无
  */
int main(void)
{
	/*初始化------------------------------------------------------------------------------------------------------------------------------------------------------*/
	SysTick_Init ();
	
	LED_GPIO_Config ();
		
	/* USART1 config 115200 8-N-1 */
	USART1_Config ();
	
	lcd_GPIO_Config ();
	Lcd_Int();
		
	Matrixkey_Init ();	 	
	
	TIM2_Configuration ();									/* led 端口配置 */ 
	TIM2_NVIC_Configuration ();								/* 定时器的中断优先级 */
	RCC_APB1PeriphClockCmd (RCC_APB1Periph_TIM2, ENABLE);	/* TIM2 重新开时钟，开始计时 */
	/*-------------------------------------------------------------------------------------------------------------------------------------------------------*/

	/*初始化显示----------------------------------------------------------------------------------------------------------------------------------------------------------*/		
	printf("\r\n this is a usart printf demo \r\n");

	printf("\r\n 欢迎使用野火 iSO-MINI STM32 开发板 \r\n");		

//	LCD_Write_String(0, 0, &Array_Word[0]);		
	/*----------------------------------------------------------------------------------------------------------------------------------------------------------*/		
	
	while(1)
	{
		/*计数----------------------------------------------------------------------------------------------------------------------------------------------------------*/				
		Counter++;	
		
		sprintf (&Array_Word[0], "%d", Counter);
		LCD_Write_String (9, 0, &Array_Word[0]);	
		/*----------------------------------------------------------------------------------------------------------------------------------------------------------*/		


//		/*矩阵键盘-----------------------------------------------------------------------------------------------------------------------------------------------------------*/		
//		KeyTemp = Get_KeyValue ();

//		if (KeyTemp != 0)
//		{
//			LCD_Write_Char (15, 0, KeyTemp); 
//			
//			if(KeyTemp != '=')
//			{
//				STMFLASH_Write (FLASH_SAVE_ADDR, (u16*)FlashWriteBuffer, FlashSIZE);
//			}
//			else
//			{
//				STMFLASH_Read (FLASH_SAVE_ADDR, (u16*)FlashReadBuffer, FlashSIZE);
//				LCD_Write_String (0, 1, FlashReadBuffer);
//			}			
//		} 
//		/*----------------------------------------------------------------------------------------------------------------------------------------------------------*/		
	
		
		/*LED灯----------------------------------------------------------------------------------------------------------------------------------------------------------*/				
		if (time == 100) /* 1000 * 1 ms = 1s 时间到 */
		{
			time = 0;
			/* LED1 取反 */      
			LED1_TOGGLE; 
		} 

//		GPIO_SetBits(GPIOD,GPIO_Pin_9);
//		Delay_us(50000);
//		GPIO_ResetBits(GPIOD,GPIO_Pin_9);
//		Delay_us(50000);  
		/*----------------------------------------------------------------------------------------------------------------------------------------------------------*/		 		
	}
}
/*********************************************END OF FILE**********************/
